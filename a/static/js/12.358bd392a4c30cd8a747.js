webpackJsonp([12],{eSYa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("t5DY"),i={name:"userList",data:function(){return{isAdd:!1,formTitle:"",dialogVisible:!1,choseFoodVisible:!1,choseSchoolVisible:!1,form:{id:0,menuName:"",menuCat:1,menuCatName:"",rangeId:"",rangeName:"",menuType:"",menuTypeName:"",content:[]},formInline:{menuName:""},menuCatArr:{1:"周度菜单",2:"月度菜单"},menuTypeArr:{1:"早餐",2:"午餐",3:"晚餐"},weekDayArr:{1:"星期日",2:"星期一",3:"星期二",4:"星期三",5:"星期四",6:"星期五",7:"星期六"},kitchenData:[],rangeData:[],menuFoodData:[],foodId:0,foodSelect:[],foodData:[],listData:[],pageIndex:1,pageSize:15,pageTotal:0,school:{menuId:0,list:[],select:[]},rules:{menuName:[{required:!0,message:"请输入菜单名称",trigger:["blur","change"]},{required:!0,min:2,max:128,message:"菜单名称不能小于2或大于128个字符",trigger:["blur","change"]}],price:[{required:!0,message:"请选择菜品价格",trigger:["blur","change"]}],menuCat:[{required:!0,message:"请选择类型",trigger:["blur","change"]}],rangeId:[{required:!0,message:"请选择时段",trigger:["blur","change"]}],menuType:[{required:!0,message:"请选择餐段",trigger:["blur","change"]}]}}},methods:{getAdminList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,i={menuName:this.formInline.menuName,pageIndex:t,pageSize:a};o.c.getMenuList(i).then(function(o){var i=[],n=0,s=(t-1)*a+1;o.data&&(o.data.list.forEach(function(t,a){i.push({rowId:s,id:t.id,kitchenName:t.kitchenName,menuName:t.menuName,menuCat:e.menuCatArr[t.menuCat],rangeName:t.rangeName,menuType:e.menuTypeArr[t.menuType],schoolName:t.schoolName,createTime:t.createTime}),s++}),n=o.data.total),console.log(i),e.listData=i,e.pageTotal=n})},getAdminInfo:function(e){var t=this;o.c.getMenuInfo(e).then(function(e){if(e.data){var a=e.data.info,o={id:a.id,menuName:a.menuName,menuCat:a.menuCat,menuCatName:t.menuCatArr[a.menuCat],rangeName:a.rangeName,menuType:a.menuType,menuTypeName:t.menuTypeArr[a.menuType],createTime:a.createTime};t.form=o}})},getMenuFoodInfo:function(e){var t=this;o.c.getMenuFoodInfo(e).then(function(e){var a=[];if(e.data){e.data.list;e.data.list.forEach(function(e,o){a.push({rowId:o,id:e.id,orderDate:e.orderDate,orderWeekday:t.weekDayArr[e.orderWeekday],content:e.content})}),t.menuFoodData=a,console.log(a)}})},getMenuSchoolInfo:function(e){var t=this;o.c.getMenuSchoolInfo(e).then(function(a){var o=[],i=[];a.data&&(a.data.list.forEach(function(e,t){o.push({rowId:t,id:e.id,schoolName:e.schoolName})}),a.data.select.forEach(function(e,t){i.push(e.id)}),t.school.menuId=e,t.school.list=o,t.school.select=i)})},getFoodSelect:function(){var e=this;o.d.getFoodSelect({}).then(function(t){var a=[];t.data&&(t.data.list.forEach(function(e,t){a.push({id:e.id,foodName:e.foodName,price:e.price})}),e.foodData=a,console.log(e.foodData))})},addUser:function(){this.formTitle="新增菜单",this.isAdd=!0,this.dialogVisible=!0,this.clearForm(),console.log(this.form)},cancelForm:function(){this.dialogVisible=!1},closeChoseFood:function(){this.choseFoodVisible=!1},changeChoseFood:function(e){console.log(e),console.log(this.foodSelect)},submitAddForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.isAdd?t.addAdminInfo():t.updateAdminInfo()})},addAdminInfo:function(){var e=this,t={menuName:this.form.menuName,menuCat:this.form.menuCat,rangeId:this.form.rangeId,menuType:this.form.menuType};o.c.addMenuInfo(t).then(function(t){t.data&&(0==t.data.err?(e.$message({type:"success",message:"保存成功!"}),e.dialogVisible=!1,e.getAdminList()):e.$message({type:"error",message:"保存失败!"}))})},updateAdminInfo:function(){var e=this,t={id:this.form.id,foodName:this.form.foodName,foodDesc:this.form.foodDesc,price:this.form.price};o.c.updateFoodInfo(t).then(function(t){t.data&&(0==t.data.err?(e.$message({type:"success",message:"保存成功!"}),e.choseFoodVisible=!1,e.getAdminList()):1==t.data.err?e.$message({type:"error",message:"无效的菜单名称!"}):2==t.data.err?e.$message({type:"error",message:"无效的时间段!"}):4==t.data.err?e.$message({type:"error",message:"已存在该时间段菜单!"}):e.$message({type:"error",message:"保存失败!"}))})},updateMenuFoodInfo:function(){var e=this,t={id:this.foodId,menuId:this.form.id,contentId:this.foodSelect};o.c.updateMenuFoodInfo(t).then(function(t){t.data&&(0==t.data.err?(e.$message({type:"success",message:"保存成功!"}),e.choseFoodVisible=!1,e.getMenuFoodInfo(e.form.id)):1==t.data.err?e.$message({type:"error",message:"无效的菜单!"}):2==t.data.err?e.$message({type:"error",message:"超出数量限制，每天最多只能加入9个菜品!"}):e.$message({type:"error",message:"保存失败!"}))})},submitFoodForm:function(){this.updateMenuFoodInfo()},choseFood:function(e){this.choseFoodVisible=!0;var t=this.menuFoodData[e],a=[];t.content.forEach(function(e,t){a.push(e.id)}),this.foodId=t.id,this.foodSelect=a,this.getFoodSelect()},getRangeWeekList:function(){var e=this;o.c.getRangeWeekList({}).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.rangeName})}),e.rangeData=a}})},getRangeMonthList:function(){var e=this;o.c.getRangeMonthList({}).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.rangeName})}),e.rangeData=a}})},getKitchenSelect:function(){var e=this;o.d.getKitchenSelect().then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.kitchenName})}),e.kitchenData=a}})},changeMenuCat:function(e){1==e?this.getRangeWeekList():2==e&&this.getRangeMonthList()},clearForm:function(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.form={id:0,foodName:"",foodDesc:"",price:""}},submitForm:function(){this.getAdminList()},goToDetail:function(e){this.formTitle="编辑菜单",this.isAdd=!1,this.dialogVisible=!0,this.clearForm(),this.getAdminInfo(e),this.getMenuFoodInfo(e)},handleSizeChange:function(e){this.pageSize=e,this.getAdminList(this.pageIndex,e)},handleCurrentChange:function(e){this.pageIndex=e,this.getAdminList(e,this.pageSize)}},mounted:function(){this.getKitchenSelect(),this.getAdminList()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userList"},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"queryList"},[a("el-form",{staticClass:"form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-form-item",{staticStyle:{width:"150px"},attrs:{prop:"menuName"}},[a("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入菜单名称"},model:{value:e.formInline.menuName,callback:function(t){e.$set(e.formInline,"menuName","string"==typeof t?t.trim():t)},expression:"formInline.menuName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("formInline")}}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"default"},on:{click:e.addUser}},[e._v("添加菜单")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"tableCom",staticStyle:{"margin-top":"15px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.listData,border:""}},[a("el-table-column",{attrs:{prop:"rowId",label:"序号",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"menuName",label:"菜单名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"menuCat",width:"80",label:"类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"menuType",width:"80",label:"餐段"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rangeName",width:"220",label:"时段"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{staticStyle:{display:"none"},attrs:{fixed:"right",align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.goToDetail(t.row.id)}}},[e._v("查看")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"pagination",staticStyle:{"margin-top":"15px"}},[a("el-pagination",{attrs:{"page-sizes":[15,30,45,60],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:e.pageTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("div",{staticClass:"dialogBox"},[a("el-dialog",{attrs:{title:e.formTitle,visible:e.dialogVisible,"show-close":!0,width:"750px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.cancelForm}},[a("div",{staticClass:"wrapper"},[a("div",[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[a("el-row",[a("div",{staticClass:"grid-content bg-purple"},[0==e.isAdd?a("el-form-item",{attrs:{label:"菜单名称：",prop:"menuName"}},[a("span",[e._v(e._s(e.form.menuName))])]):a("el-form-item",{attrs:{label:"菜单名称：",prop:"menuName"}},[a("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",clearable:"",placeholder:"请输入菜单名称"},model:{value:e.form.menuName,callback:function(t){e.$set(e.form,"menuName","string"==typeof t?t.trim():t)},expression:"form.menuName"}})],1),e._v(" "),0==e.isAdd?a("el-form-item",{attrs:{label:"类型：",prop:"menuCat"}},[a("span",[e._v(e._s(e.form.menuCatName))])]):a("el-form-item",{attrs:{label:"类型：",prop:"menuCat"}},[a("el-radio",{attrs:{label:"1"},on:{change:e.changeMenuCat},model:{value:e.form.menuCat,callback:function(t){e.$set(e.form,"menuCat",t)},expression:"form.menuCat"}},[e._v("周度菜单")])],1),e._v(" "),0==e.isAdd?a("el-form-item",{attrs:{label:"时段：",prop:"rangeId"}},[a("span",[e._v(e._s(e.form.rangeName))])]):a("el-form-item",{attrs:{label:"时段：",prop:"rangeId"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择日期时段"},model:{value:e.form.rangeId,callback:function(t){e.$set(e.form,"rangeId",t)},expression:"form.rangeId"}},e._l(e.rangeData,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),0==e.isAdd?a("el-form-item",{attrs:{label:"餐段：",prop:"menuType"}},[a("span",[e._v(e._s(e.form.menuTypeName))])]):a("el-form-item",{attrs:{label:"餐段：",prop:"menuType"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.form.menuType,callback:function(t){e.$set(e.form,"menuType",t)},expression:"form.menuType"}},[e._v("早餐")]),e._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:e.form.menuType,callback:function(t){e.$set(e.form,"menuType",t)},expression:"form.menuType"}},[e._v("午餐")]),e._v(" "),a("el-radio",{attrs:{label:"3"},model:{value:e.form.menuType,callback:function(t){e.$set(e.form,"menuType",t)},expression:"form.menuType"}},[e._v("晚餐")])],1),e._v(" "),0==e.isAdd?a("el-form-item",{attrs:{label:"创建时间：",prop:"createTime"}},[a("span",[e._v(e._s(e.form.createTime))])]):e._e()],1)])],1),e._v(" "),0==e.isAdd?a("el-row",[a("div",{staticClass:"food-table",staticStyle:{"margin-top":"15px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.menuFoodData,border:"","show-header":!1}},[a("el-table-column",{attrs:{align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.orderDate))]),e._v(" "),a("div",[e._v(e._s(t.row.orderWeekday))])]}}],null,!1,616556644)}),e._v(" "),a("el-table-column",{attrs:{align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"food-list"},[e._l(t.row.content,function(t,o){return a("div",{key:o,staticClass:"food-item"},[a("div",{staticClass:"food-name"},[e._v(e._s(t.foodName))]),e._v(" "),a("div",{staticClass:"food-price"},[e._v(e._s(t.price))])])}),e._v(" "),a("div",{staticClass:"food-item"},[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.choseFood(t.row.rowId)}}},[e._v("编辑")])],1)],2)]}}],null,!1,968410820)})],1)],1)]):e._e()],1)]),e._v(" "),1==e.isAdd?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cancelForm()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitAddForm("ruleForm")}}},[e._v("保存")])],1):e._e()])],1),e._v(" "),a("div",{staticClass:"choseFoodBox"},[a("el-dialog",{attrs:{title:e.formTitle,visible:e.choseFoodVisible,"show-close":!0,width:"750px"},on:{"update:visible":function(t){e.choseFoodVisible=t},close:e.closeChoseFood}},[a("div",{staticClass:"wrapper"},[a("el-row",[a("div",{staticClass:"tableCom",staticStyle:{"margin-top":"15px"}},[a("div",{staticClass:"food-list"},[a("el-checkbox-group",{on:{change:e.changeChoseFood},model:{value:e.foodSelect,callback:function(t){e.foodSelect=t},expression:"foodSelect"}},e._l(e.foodData,function(t,o){return a("el-checkbox-button",{key:o,staticClass:"chose-item",attrs:{label:t.id}},[a("div",[e._v(e._s(t.foodName))]),e._v(" "),a("div",[e._v(e._s(t.price))])])}),1)],1)])])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.closeChoseFood()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitFoodForm()}}},[e._v("保存")])],1)])],1)])])},staticRenderFns:[]};var s=a("VU/8")(i,n,!1,function(e){a("zWTJ")},null,null);t.default=s.exports},zWTJ:function(e,t){}});
//# sourceMappingURL=12.358bd392a4c30cd8a747.js.map