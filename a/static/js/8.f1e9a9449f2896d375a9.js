webpackJsonp([8],{MVB5:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("t5DY"),l={name:"orderList",data:function(){return{dialogVisible:!1,formInline:{gradeId:"",dateVals:[],dinerName:"",orderStatus:"",mealTime:"",kitchenId:""},form:{mealDate:"",mealTime:"",gradeId:"",dinerId:"",foodId:"",gradeData:[],foodData:[],dinerData:[]},mealTimeArr:{BREAKFAST:"早餐",LUNCH:"午餐",DINNER:"晚餐"},orderStatusArr:{PAID:"未完成",FINISH:"已完成",CANCELED:"已退款"},takeMealModeArr:{CANTEEN:"堂食预定",CABINET:"保温柜预定",ORDERMACHINE:"窗口点餐"},gradeData:[],listData:[],pageIndex:1,pageSize:15,pageTotal:0,totalSum:"0.00",paySum:"0.00",infoData:{},dialogTableData:[{shouldGet:-20.5,factGet:10.5}],dialogGatheringTableData:[],dialogOrderingTableData:[],rules:{gradeId:[{required:!0,message:"请选择部门",trigger:["blur","change"]}],studentName:[{required:!0,message:"请输入姓名",trigger:["blur","change"]}]}}},methods:{formatAmount:function(e){var t=(100*e/100).toFixed(2)+"";return t.substring(0,t.indexOf(".")).replace(/\B(?=(?:\d{3})+$)/g,",")+t.substring(t.length,t.indexOf("."))},formatNumber:function(e){return e.replace(/\B(?=(?:\d{3})+$)/g,",")},getOrderList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,l={gradeId:Number(this.formInline.gradeId),dateRange:null==this.formInline.dateVals?[]:this.formInline.dateVals,dinerName:this.formInline.dinerName,orderStatus:this.formInline.orderStatus,mealTime:this.formInline.mealTime,pageIndex:t,pageSize:a};r.c.getOrderList(l).then(function(r){var l=[],i=0,o="0.00",n="0.00",s=(t-1)*a+1;r.data&&(r.data.list.forEach(function(t,a){l.push({rowId:s,id:t.id,mealDate:t.mealDate,mealTime:e.mealTimeArr[t.mealTime],gradeName:t.gradeName,dinerName:t.dinerName,foodName:t.foodName,totalMoney:e.formatAmount(t.totalMoney),payMoney:e.formatAmount(t.payMoney),takeMealMode:"CABINET"==t.takeMealMode?e.takeMealModeArr[t.takeMealMode]+"("+t.deviceName+t.cabinetCellId+")":e.takeMealModeArr[t.takeMealMode],orderStatus:e.orderStatusArr[t.orderState]}),s++}),i=r.data.total,o=r.data.totalSum,n=r.data.paySum),e.listData=l,e.pageTotal=Number(i),e.totalSum=e.formatAmount(o),e.paySum=e.formatAmount(n)})},getGradeSelect:function(){var e=this;r.d.getGradeSelect({schoolId:1}).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.gradeName})}),e.formInline.gradeId="",e.gradeData=a,e.formInline.classId="",e.classData=[]}})},handleSizeChange:function(e){this.pageSize=e,this.getOrderList(this.pageIndex,e)},handleCurrentChange:function(e){this.pageIndex=e,this.getOrderList(e,this.pageSize)},handleFromGradeChange:function(){this.getFormDinerSelect()},changeDate:function(){this.formInline.dateVals||(this.formInline.dateVals=[],console.log(this.formInline.dateVals))},changeFormDate:function(){this.form.mealDate||(this.form.mealDate="")},submitAddForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.addOrderInfo()})},cancelForm:function(){this.dialogVisible=!1},addOrderInfo:function(){var e=this,t={mealDate:this.form.mealDate,mealTime:this.form.mealTime,gradeId:Number(this.form.gradeId),dinerId:Number(this.form.dinerId),foodId:Number(this.form.foodId)};r.c.addOrderInfo(t).then(function(t){t.data&&(0==t.data.err?(e.$message({type:"success",message:"保存成功!"}),e.dialogVisible=!1,e.getOrderList()):1==t.data.err?e.$message({type:"error",message:"无效的用餐用户"}):2==t.data.err?e.$message({type:"error",message:"无效的菜品"}):3==t.data.err&&e.$message({type:"error",message:"余额不足"}))})},addOrder:function(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.dialogVisible=!0,this.getFormGradeSelect(),this.getFormFoodSelect()},getFormGradeSelect:function(){var e=this;this.form.classData=[];r.d.getGradeSelect({schoolId:1}).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.gradeName})}),e.form.gradeData=a}})},getFormFoodSelect:function(){var e=this;r.d.getFoodSelect({kitchenId:1}).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.foodName+"("+e.price+"元)"})}),e.form.foodData=a}})},getFormDinerSelect:function(){var e=this,t={gradeId:Number(this.form.gradeId)};r.d.getDinerSelect(t).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.dinerName+"("+e.money+"元)"})}),e.form.dinerData=a}})},submitForm:function(){this.getOrderList()},deleteUser:function(e){var t=this;this.$confirm("是否取消订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.cancelOrderInfo(e.id)}).catch(function(){})},cancelOrderInfo:function(e){var t=this;r.c.cancelOrderInfo(e).then(function(e){e.data&&0==e.data.err&&(t.$message({type:"success",message:"取消成功!"}),t.getOrderList())})}},mounted:function(){this.getGradeSelect(),this.getOrderList()}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"orderList"},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"queryList"},[a("el-form",{staticClass:"form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-row",[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{prop:"dateVals"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange",size:"small","range-separator":"至","start-placeholder":"用餐开始日期","end-placeholder":"用餐结束日期",align:"right"},on:{change:e.changeDate},model:{value:e.formInline.dateVals,callback:function(t){e.$set(e.formInline,"dateVals",t)},expression:"formInline.dateVals"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"150px"},attrs:{prop:"gradeId"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择部门",size:"small"},model:{value:e.formInline.gradeId,callback:function(t){e.$set(e.formInline,"gradeId","string"==typeof t?t.trim():t)},expression:"formInline.gradeId"}},e._l(e.gradeData,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t.name,value:t.id}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"150px"},attrs:{prop:"dinerName"}},[a("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入姓名"},model:{value:e.formInline.dinerName,callback:function(t){e.$set(e.formInline,"dinerName","string"==typeof t?t.trim():t)},expression:"formInline.dinerName"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"120px"},attrs:{prop:"orderStatus"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择订单状态",size:"small"},model:{value:e.formInline.orderStatus,callback:function(t){e.$set(e.formInline,"orderStatus","string"==typeof t?t.trim():t)},expression:"formInline.orderStatus"}},e._l(e.orderStatusArr,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t,value:r}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"120px"},attrs:{prop:"mealTime"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择餐别",size:"small"},model:{value:e.formInline.mealTime,callback:function(t){e.$set(e.formInline,"mealTime","string"==typeof t?t.trim():t)},expression:"formInline.mealTime"}},e._l(e.mealTimeArr,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t,value:r}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("formInline")}}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"default"},on:{click:e.addOrder}},[e._v("增补订单")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dataTotal"},[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",[a("div",{staticClass:"left"},[e._v("应收金额合计\n              "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"筛选结果的订单应收金额合计",placement:"top-start"}},[a("i",{staticClass:"el-icon-question"})])],1),e._v(" "),a("div",{staticClass:"num"},[e._v(e._s(e.totalSum))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",[a("div",{staticClass:"left"},[e._v("实收金额合计\n              "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"筛选结果的订单的实收金额合计",placement:"top-start"}},[a("i",{staticClass:"el-icon-question"})])],1),e._v(" "),a("div",{staticClass:"num"},[e._v(e._s(e.paySum))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",[a("div",{staticClass:"left"},[e._v("出餐份数合计\n              "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"筛选结果的全部出餐份数合计",placement:"top-start"}},[a("i",{staticClass:"el-icon-question"})])],1),e._v(" "),a("div",{staticClass:"num"},[e._v(e._s(e.pageTotal))])])])],1)],1),e._v(" "),a("div",{staticClass:"tableCom",staticStyle:{"margin-top":"15px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.listData,"highlight-current-row":"",border:""}},[a("el-table-column",{attrs:{prop:"rowId",label:"序号",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mealDate",label:"用餐日期",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mealTime",label:"餐段",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"gradeName",label:"部门"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dinerName",label:"姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"foodName",label:"菜品"}}),e._v(" "),a("el-table-column",{attrs:{prop:"totalMoney",label:"应付金额",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"payMoney",label:"实付金额",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"takeMealMode",label:"取餐方式"}}),e._v(" "),a("el-table-column",{attrs:{prop:"orderStatus",label:"订单状态",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["已退款"!=t.row.orderStatus?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.deleteUser(t.row)}}},[e._v("退款")]):e._e()]}}])})],1)],1),e._v(" "),a("div",{staticClass:"pagination",staticStyle:{"margin-top":"15px"}},[a("el-pagination",{attrs:{"page-sizes":[15,30,45,60],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("div",{staticClass:"dialogBox"},[a("el-dialog",{attrs:{title:"增补订单",visible:e.dialogVisible,"show-close":!1,width:"750px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"wrapper"},[a("div",[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"日期：",prop:"mealDate"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",size:"small",placeholder:"用餐日期",align:"right"},on:{change:e.changeFormDate},model:{value:e.form.mealDate,callback:function(t){e.$set(e.form,"mealDate",t)},expression:"form.mealDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"餐段：",prop:"mealTime"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请选择餐段",size:"small"},model:{value:e.form.mealTime,callback:function(t){e.$set(e.form,"mealTime","string"==typeof t?t.trim():t)},expression:"form.mealTime"}},e._l(e.mealTimeArr,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t,value:r}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"部门：",prop:"gradeId"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请选择部门",size:"small"},on:{change:e.handleFromGradeChange},model:{value:e.form.gradeId,callback:function(t){e.$set(e.form,"gradeId","string"==typeof t?t.trim():t)},expression:"form.gradeId"}},e._l(e.form.gradeData,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t.name,value:t.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"人员：",prop:"dinerId"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择人员",size:"small"},model:{value:e.form.dinerId,callback:function(t){e.$set(e.form,"dinerId","string"==typeof t?t.trim():t)},expression:"form.dinerId"}},e._l(e.form.dinerData,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t.name,value:t.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"菜品：",prop:"foodId"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择菜品",size:"small"},model:{value:e.form.foodId,callback:function(t){e.$set(e.form,"foodId","string"==typeof t?t.trim():t)},expression:"form.foodId"}},e._l(e.form.foodData,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t.name,value:t.id}})}),1)],1)],1)],1)]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cancelForm("ruleForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitAddForm("ruleForm")}}},[e._v("确 定")])],1)])],1)])])},staticRenderFns:[]};var o=a("VU/8")(l,i,!1,function(e){a("z290")},null,null);t.default=o.exports},z290:function(e,t){}});
//# sourceMappingURL=8.f1e9a9449f2896d375a9.js.map