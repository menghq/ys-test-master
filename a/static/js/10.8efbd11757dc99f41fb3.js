webpackJsonp([10],{TnCl:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("t5DY"),i={name:"userList",data:function(){return{isAdd:!1,dialogVisible:!1,formInline:{dateVals:[],gradeId:"",transactionType:"",dinerName:""},form:{gradeId:"",dinerId:"",gradeData:[],dinerData:[],amount:""},transactionTypeArr:{INCOME:"充值",REFUND:"提现"},incomeAmount:"0.00",incomeCount:"0",refundAmount:"0.00",refundCount:"0",gradeData:[],listData:[],pageIndex:1,pageSize:15,pageTotal:0,rules:{gradeId:[{required:!0,message:"请选择部门",trigger:["blur","change"]}],dinerId:[{required:!0,message:"请选择充值人员",trigger:["blur","change"]}],amount:[{required:!0,message:"请输入充值金额",trigger:["blur","change"]}]}}},methods:{getWalletLogList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,i={dateRange:null==this.formInline.dateVals?[]:this.formInline.dateVals,action:"RECHARGE",dinerName:this.formInline.dinerName,pageIndex:t,pageSize:a};r.a.getWalletLogList(i).then(function(r){var i=[],n=0,l="0.00",o="0",s="0.00",d="0",m=(t-1)*a+1;r.data&&(r.data.list.forEach(function(t,a){i.push({rowId:m,id:t.id,outTradeNo:t.outTradeNo,dinerName:t.dinerName,action:e.transactionTypeArr[t.transactionType],money:t.money,createTime:t.createTime}),m++}),n=r.data.total,l=r.data.incomeAmount,o=r.data.incomeCount,s=r.data.refundAmount,d=r.data.refundCount),console.log(i),e.listData=i,e.pageTotal=n,e.incomeAmount=l,e.incomeCount=o,e.refundAmount=s,e.refundCount=d})},submitForm:function(){this.getWalletLogList()},handleSizeChange:function(e){this.pageSize=e,this.getWalletLogList(this.pageIndex,e)},handleCurrentChange:function(e){this.pageIndex=e,this.getWalletLogList(e,this.pageSize)},changeDate:function(){this.formInline.dateVals||(this.formInline.dateVals=[],console.log(this.formInline.dateVals))},cancelForm:function(){this.dialogVisible=!1},addRecharge:function(){this.$refs.ruleForm&&this.$refs.ruleForm.resetFields(),this.dialogVisible=!0,this.getFormGradeSelect()},getFormGradeSelect:function(){var e=this;this.form.classData=[];r.d.getGradeSelect({schoolId:1}).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.gradeName})}),e.form.gradeData=a}})},getFormDinerSelect:function(){var e=this,t={gradeId:Number(this.form.gradeId)};r.d.getDinerSelect(t).then(function(t){if(t.data){var a=[];t.data.list.forEach(function(e,t){a.push({id:e.id,name:e.dinerName+"("+e.money+"元)"})}),e.form.dinerData=a}})},handleFromGradeChange:function(){this.getFormDinerSelect()},addRechargeInfo:function(){var e=this,t={gradeId:Number(this.form.gradeId),dinerId:Number(this.form.dinerId),amount:this.form.amount};r.a.addRechargeInfo(t).then(function(t){t.data&&(0==t.data.err?(e.$message({type:"success",message:"保存成功!"}),e.dialogVisible=!1,e.getWalletLogList()):1==t.data.err&&e.$message({type:"error",message:"无效的人员"}))})},submitAddForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.addRechargeInfo()})}},mounted:function(){this.getWalletLogList()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userList"},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"queryList"},[a("el-form",{staticClass:"form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-form-item",{attrs:{prop:"dateVals"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange",size:"small","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},on:{change:e.changeDate},model:{value:e.formInline.dateVals,callback:function(t){e.$set(e.formInline,"dateVals",t)},expression:"formInline.dateVals"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"150px"},attrs:{prop:"userName"}},[a("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入人员姓名"},model:{value:e.formInline.dinerName,callback:function(t){e.$set(e.formInline,"dinerName","string"==typeof t?t.trim():t)},expression:"formInline.dinerName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm("formInline")}}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"default"},on:{click:e.addRecharge}},[e._v("手动充值")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"tableCom",staticStyle:{"margin-top":"15px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.listData,border:""}},[a("el-table-column",{attrs:{prop:"rowId",label:"序号",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",width:"200",label:"充值时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dinerName",width:"200",label:"人员姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"money",label:"金额"}})],1)],1),e._v(" "),a("div",{staticClass:"pagination",staticStyle:{"margin-top":"15px"}},[a("el-pagination",{attrs:{"page-sizes":[15,30,45,60],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:e.pageTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("div",{staticClass:"dialogBox"},[a("el-dialog",{attrs:{title:"手动充值",visible:e.dialogVisible,"show-close":!1,width:"750px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"wrapper"},[a("div",[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"部门：",prop:"gradeId"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请选择部门",size:"small"},on:{change:e.handleFromGradeChange},model:{value:e.form.gradeId,callback:function(t){e.$set(e.form,"gradeId","string"==typeof t?t.trim():t)},expression:"form.gradeId"}},e._l(e.form.gradeData,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t.name,value:t.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"人员：",prop:"dinerId"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择人员",size:"small"},model:{value:e.form.dinerId,callback:function(t){e.$set(e.form,"dinerId","string"==typeof t?t.trim():t)},expression:"form.dinerId"}},e._l(e.form.dinerData,function(t,r){return a("el-option",{key:e._uid+"_"+r,attrs:{"element-loading-spinner":"el-icon-loading",label:t.name,value:t.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"充值金额：",prop:"amount"}},[a("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",clearable:"",placeholder:"请输入充值金额"},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount","string"==typeof t?t.trim():t)},expression:"form.amount"}})],1)],1)],1)]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cancelForm("ruleForm")}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitAddForm("ruleForm")}}},[e._v("确 定")])],1)])],1)])])},staticRenderFns:[]};var l=a("VU/8")(i,n,!1,function(e){a("WMQe")},null,null);t.default=l.exports},WMQe:function(e,t){}});
//# sourceMappingURL=10.8efbd11757dc99f41fb3.js.map